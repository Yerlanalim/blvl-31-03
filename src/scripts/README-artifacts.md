# Загрузка тестовых артефактов

Этот документ содержит инструкции по запуску скрипта `upload-artifacts.js`, который загружает тестовые артефакты в Firebase Storage и создает соответствующие записи в Firestore.

## Описание скрипта

Скрипт `upload-artifacts.js` выполняет следующие действия:

1. Генерирует тестовые файлы в папке `sample-files` (если они отсутствуют)
2. Загружает файлы в Firebase Storage
3. Создает записи в коллекции `artifacts` в Firestore
4. Обновляет документы уровней, добавляя ID артефактов в массив `relatedArtifactIds`

## Предварительные требования

Перед запуском скрипта убедитесь, что выполнены следующие условия:

1. Проект Firebase настроен и доступен
2. Сервисный аккаунт Firebase создан и ключ доступа сохранен в корне проекта как `firebase-service-account.json`
3. Node.js установлен (версия 14 или выше)
4. Установлен пакет `firebase-admin`:
   ```
   npm install firebase-admin
   ```

## Получение сервисного аккаунта Firebase

Для получения сервисного аккаунта Firebase:

1. Перейдите в [Firebase Console](https://console.firebase.google.com/)
2. Выберите ваш проект
3. Перейдите в "Project settings" (Настройки проекта)
4. Выберите вкладку "Service accounts" (Сервисные аккаунты)
5. Нажмите "Generate new private key" (Создать новый приватный ключ)
6. Сохраните файл как `firebase-service-account.json` в корне проекта

## Запуск скрипта

Для запуска скрипта выполните следующие команды:

```bash
# Перейдите в корневую директорию проекта
cd /path/to/your/project

# Запустите скрипт
node src/scripts/upload-artifacts.js
```

## Тестовые артефакты

Скрипт генерирует и загружает следующие артефакты:

### Уровень 1
1. Базовый шаблон бизнес-плана (PDF)
2. Таблица финансового планирования (XLSX)
3. Чек-лист анализа рынка (PDF)

### Уровень 2
1. Руководство по базовому маркетингу (PDF)
2. Шаблон маркетингового плана (DOCX)
3. Калькулятор ROI маркетинговых кампаний (XLSX)

### Уровень 3
1. Руководство по управлению персоналом (PDF)
2. Шаблон должностной инструкции (DOCX)
3. Калькулятор эффективности сотрудников (XLSX)

## Структура данных в Firestore

Каждый артефакт создается в коллекции `artifacts` со следующими полями:

- `id`: Уникальный идентификатор артефакта
- `title`: Название артефакта
- `description`: Описание артефакта
- `fileURL`: URL для скачивания файла из Storage
- `fileName`: Имя файла
- `fileType`: Тип файла (MIME-тип)
- `levelId`: ID уровня, к которому относится артефакт
- `downloadCount`: Счетчик скачиваний (начальное значение 0)
- `uploadedAt`: Дата и время загрузки

## Решение проблем

### Ошибка аутентификации
Если вы получаете ошибку аутентификации, убедитесь, что:
- Файл `firebase-service-account.json` правильно размещен в корне проекта
- Ключ содержит правильные учетные данные
- У сервисного аккаунта есть необходимые права доступа

### Ошибка при обновлении уровней
Если уровни не обновляются, убедитесь, что:
- Документы уровней существуют в коллекции `levels`
- Используются правильные ID уровней (level-1, level-2, level-3, и т.д.)

### Ошибка при создании файлов
Если возникают проблемы с созданием файлов, проверьте:
- Права доступа к папке `sample-files`
- Наличие свободного места на диске

## Дополнительная информация

- Если вам нужно изменить структуру артефактов, отредактируйте массив `testArtifacts` в начале скрипта
- Для генерации реальных файлов вместо заглушек, вы можете заменить логику в функции `generateSampleFiles()`
- Для тестирования с реальными файлами, просто поместите файлы с соответствующими именами в папку `sample-files` 