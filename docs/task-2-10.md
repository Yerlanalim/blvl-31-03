# Задача 2.10: Реализация редиректов для аутентифицированных/неаутентифицированных пользователей

## Описание
Реализовать систему редиректов для корректной навигации между защищенными и публичными страницами в зависимости от статуса аутентификации пользователя.

## Ссылки на документацию
- [Этап 2, Шаг 4](../BizLevel-%20План%20Реализации%20Проекта.%2031.03.rtf): Защищенные Маршруты
- [Раздел 6: Пользовательский путь (User Flow)](../Данные%20по%20МВП,%2025.04.pdf): Описание пользовательского пути, начинающегося с регистрации/входа

## Конкретные шаги для Cursor
1. Создать компонент или утилиту `RedirectBasedOnAuth` для обработки редиректов
2. Обновить корневую страницу `src/app/page.tsx` для правильного редиректа
3. Настроить логику для сохранения URL, с которого пользователь был перенаправлен, чтобы вернуть его туда после аутентификации
4. Обеспечить корректную обработку состояния загрузки

## Промт для Cursor
```
Помоги мне реализовать систему редиректов для аутентифицированных/неаутентифицированных пользователей в проекте BizLevel.

Задача состоит из нескольких частей:

1. Обновить корневую страницу `src/app/page.tsx`:
   - Импортировать redirect из next/navigation
   - Реализовать редирект на `/map` (для аутентифицированных пользователей) или `/login` (для неаутентифицированных)
   - Можно использовать серверные компоненты Next.js и cookies для определения статуса аутентификации

2. Создать утилиту для сохранения URL перед редиректом:
   - Создать файл `src/lib/utils/auth-redirect.ts`
   - Реализовать функции для сохранения и получения URL в/из localStorage или URL параметров
   - Функция для генерации URL с параметром redirect

3. Обновить логику редиректа после успешной аутентификации:
   - В хуке `useAuth` или в компонентах форм добавить логику для перенаправления на сохраненный URL после успешной аутентификации
   - Если URL не сохранен, перенаправлять на стандартную страницу (например, `/map`)

4. Опционально: создать компонент-обертку `RedirectGuard` для использования в клиентских компонентах:
   - Создать файл `src/components/auth/RedirectGuard.tsx`
   - Компонент должен перенаправлять пользователя в зависимости от его статуса аутентификации и указанных параметров (например, isAuthRequired)

Пожалуйста, реализуй эти компоненты и утилиты для обеспечения корректной навигации пользователей в зависимости от их статуса аутентификации.

После выполнения задачи обнови status.md, указав, что задача 2.10 выполнена.
```

## Ожидаемый результат
- Обновленная корневая страница `src/app/page.tsx` с логикой редиректа
- Созданный файл `src/lib/utils/auth-redirect.ts` с утилитами для сохранения и получения URL
- Обновленная логика редиректа после успешной аутентификации
- Опционально: созданный компонент `RedirectGuard`
- Корректная навигация пользователей между защищенными и публичными страницами
- Обновленный файл status.md с отметкой о выполнении задачи 2.10

## Связь с другими задачами
- Эта задача следует за задачей 2.9: Реализация логики защиты роутов
- После выполнения этой задачи следует перейти к задаче 2.11: Настройка создания записи пользователя в Firestore

## Обновление progress-tracking
После выполнения задачи обновите файл development-plan.md, заменив `[ ]` на `[x]` для этой задачи:
```
* [x] **task-2.10-implement-auth-redirection.md**: Реализация редиректов для аутентифицированных/неаутентифицированных пользователей
```
