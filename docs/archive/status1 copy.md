# BizLevel - Статус Разработки

Этот документ содержит текущий статус разработки проекта BizLevel. Документ будет обновляться по мере выполнения задач из `development-plan.md`.

## Прогресс Разработки
- **Текущий этап:** Этап 4 (Сервисный слой и хуки)
- **Выполнено задач:** 31 из 97
- **Процент завершения:** 32%

## Журнал Изменений
- **31.03.2025:** Создан начальный план разработки и файл статуса.
- **01.04.2025:** Выполнена задача 1.1 - Инициализация проекта Next.js.
- **01.04.2025:** Выполнена задача 1.2 - Установка основных зависимостей.
- **01.04.2025:** Выполнена задача 1.3 - Настройка shadcn/ui.
- **01.04.2025:** Выполнена задача 1.4 - Настройка проекта Firebase в консоли.
- **01.04.2025:** Выполнена задача 1.5 - Создание и настройка файла `.env.local`.
- **01.04.2025:** Выполнена задача 1.6 - Добавление `.env.local` в `.gitignore`.
- **01.04.2025:** Выполнена задача 1.7 - Реализация файлов конфигурации Firebase.
- **01.04.2025:** Выполнена задача 1.8 - Настройка базовых правил безопасности Firestore и Storage.
- **01.04.2025:** Выполнена задача 1.9 - Создание базовой структуры директорий проекта.
- **01.04.2025:** Выполнена задача 1.10 - Настройка файла `src/app/providers.tsx`.
- **01.04.2025:** Выполнена задача 1.11 - Интеграция `Providers` в корневой `src/app/layout.tsx`.
- **01.04.2025:** Выполнена задача 2.1 - Создание `AuthContext` и `AuthProvider`.
- **01.04.2025:** Выполнена задача 2.2 - Реализация слушателя `onAuthStateChanged` в `AuthProvider`.
- **01.04.2025:** Выполнена задача 2.3 - Реализация функций `login`, `register`, `logout`, `resetPassword` в `AuthProvider`.
- **01.04.2025:** Выполнена задача 2.4 - Интеграция `AuthProvider` в `src/app/providers.tsx`.
- **01.04.2025:** Выполнена задача 2.5 - Создание хука `useAuth` (`src/hooks/useAuth.ts`).
- **01.04.2025:** Выполнена задача 2.6 - Создание макета для страниц аутентификации (`src/app/(auth)/layout.tsx`).
- **01.04.2025:** Выполнена задача 2.7 - Создание страниц Login, Register, Reset Password.
- **01.04.2025:** Выполнена задача 2.8 - Реализация компонентов форм аутентификации (LoginForm, RegisterForm, ResetPasswordForm) с использованием React Hook Form, Zod и shadcn/ui.
- **01.04.2025:** Выполнена задача 2.9 - Реализация логики защиты роутов в `src/app/(routes)/layout.tsx`.
- **01.04.2025:** Выполнена задача 2.10 - Реализация редиректов для аутентифицированных/неаутентифицированных пользователей.
- **01.04.2025:** Выполнена задача 2.11 - Настройка создания записи пользователя в Firestore при регистрации.
- **01.04.2025:** Выполнена задача 3.1 - Создание компонента `MainLayout`.
- **01.04.2025:** Выполнена задача 3.2 - Создание компонентов `Sidebar`, `Header`, `UserNav`.
- **01.04.2025:** Выполнена задача 3.3 - Интеграция `MainLayout` в `src/app/(routes)/layout.tsx`.
- **01.04.2025:** Выполнена задача 3.4 - Реализация навигации в `Sidebar`.
- **01.04.2025:** Выполнена задача 3.5 - Настройка редиректа с `/` на `/map` в `src/app/page.tsx`.
- **01.04.2025:** Выполнена задача 4.1 - Создание `settings-service.ts` для чтения/записи настроек пользователя.
- **01.04.2025:** Выполнена задача 4.2 - Создание хука `useSettings` с использованием React Query.
- **01.04.2025:** Выполнена задача 4.3 - Создание страницы `/profile`.
- **01.04.2025:** Выполнена задача 4.4 - Отображение информации о пользователе на странице профиля.
- **01.04.2025:** Выполнена задача 4.5 - Создание страницы `/settings`.
- **01.04.2025:** Выполнена задача 4.6 - Реализация формы для изменения `displayName`, `photoURL` и настроек.
- **01.04.2025:** Выполнена задача 4.7 - Интеграция хука `useSettings` для загрузки и сохранения настроек.
- **01.04.2025:** Выполнена задача 5.4 - Создан сервисный слой для работы с уровнями в файле `src/lib/services/level-service.ts`. Реализованы следующие функции:
  - `getLevels()` - получение всех уровней с сортировкой по полю order
  - `getLevelById(levelId)` - получение информации о конкретном уровне
  - `getLevelsWithStatus(userProgress)` - получение уровней с определением их статуса (доступен, заблокирован, завершен)
  - `getNextLevelId(currentLevelId)` - получение ID следующего уровня
  - `isLevelCompleted(userProgress, levelId)` - проверка, завершен ли уровень
- **01.04.2025:** Выполнена задача 5.5 - Создан хук `useProgress` для работы с прогрессом пользователя в файле `src/hooks/useProgress.ts`. Реализована следующая функциональность:
  - Основной хук `useProgress` - получение и инициализация прогресса пользователя с использованием React Query
  - Мутации для обновления прогресса: `useMarkVideoWatched`, `useMarkTestCompleted`, `useMarkArtifactDownloaded` и `useCompleteLevel`
  - Вспомогательные функции для проверки состояний: `isVideoWatched`, `isTestCompleted`, `isArtifactDownloaded`, `isLevelCompleted` и `canCompleteLevelCheck`
  - Интеграция с toast-уведомлениями при успешных и неуспешных мутациях
  - Автоматическая инвалидация кэша при успешных мутациях
- **01.04.2025:** Выполнена задача 5.6 - Созданы хуки для работы с уровнями в файле `src/hooks/useLevels.ts`. Реализована следующая функциональность:
  - Хук `useLevels` - получение списка всех уровней
  - Хук `useLevel` - получение информации о конкретном уровне по ID
  - Хук `useLevelsWithStatus` - получение уровней с их статусом (на основе прогресса пользователя)
  - Хук `useNextLevel` - получение информации о следующем уровне
  - Интеграция с toast-уведомлениями для обработки ошибок
  - Оптимизация кеширования с использованием staleTime
- **01.04.2025:** Выполнена задача 5.7 - Создана страница Карты Уровней (`/map`) в файле `src/app/(routes)/map/page.tsx`. Реализована следующая функциональность:
  - Клиентский компонент с использованием хуков `useLevelsWithStatus` и `useProgress`
  - Отображение общего прогресса пользователя (количество пройденных уровней и процент)
  - Реализация состояний загрузки (skeleton loaders) для улучшения UX
  - Placeholder для будущего компонента `LevelMap`
  - Информация о текущем уровне пользователя
  - Добавлен файл `metadata.ts` для SEO-оптимизации
- **01.04.2025:** Выполнена задача 5.8 - Реализован компонент `LevelMap` для визуализации карты уровней с интерактивными элементами. Реализована следующая функциональность:
  - Созданы файлы:
    - `src/components/features/LevelMap/LevelMap.tsx` - основной компонент карты уровней
    - `src/components/features/LevelMap/LevelCard.tsx` - компонент для отображения отдельного уровня
    - `src/components/features/LevelMap/index.ts` - для экспорта компонентов
  - Компонент `LevelMap`:
    - Принимает пропсы: `levels`, `isLoading`, `onLevelClick`
    - Отображает вертикальную дорожку из уровней с соединительными линиями
    - Адаптивный дизайн с различными представлениями для десктопа и мобильных устройств
    - Отображает скелетон при загрузке данных
  - Компонент `LevelCard`:
    - Визуально отображает статус уровня (заблокирован, доступен, пройден)
    - Отображает номер/порядок уровня, название и статус текстом
    - Имеет различные стили и иконки в зависимости от статуса (замок для заблокированных, галочка для пройденных)
    - Обрабатывает клики только для доступных и пройденных уровней
  - Обновлена страница `/map` для использования компонента `LevelMap`:
    - Добавлен импорт `LevelMap` и заменен placeholder
    - Добавлен обработчик клика для перехода к странице уровня
    - Добавлена передача данных из хука `useLevelsWithStatus`
  Компонент реализован в соответствии с заданием и имеет современный дизайн, адаптированный для бизнес-аудитории.
- **01.04.2025:** Выполнена задача 5.9 - Интеграция `useLevels` и `useProgress` в компонент `LevelMap` для отображения актуальных данных. Реализована следующая функциональность:
  - Создан компонент `ProgressSummary` в `src/components/features/LevelMap/ProgressSummary.tsx`:
    - Отображает прогресс прохождения уровней с использованием компонента `Progress` из shadcn/ui
    - Показывает количество пройденных уровней из общего числа
    - Имеет состояние загрузки с использованием `Skeleton`
    - Использует плавные анимации перехода между состояниями
  - Улучшен обработчик клика по уровню в `src/app/(routes)/map/page.tsx`:
    - Добавлена проверка статуса уровня перед переходом на страницу уровня
    - Для заблокированных уровней добавлено отображение toast-уведомления с информацией о необходимости прохождения предыдущих уровней
    - Обработчик оптимизирован с использованием `useCallback`
  - Добавлена обработка ошибок загрузки данных:
    - Использовано уведомление toast при возникновении ошибок
    - Добавлен `useEffect` для отслеживания изменений в состоянии ошибок
  - Добавлены плавные анимации и улучшен UX:
    - Реализована анимация `fadeIn` для плавного появления содержимого страницы
    - Добавлены переходы при наведении на элементы
    - Улучшены CSS-переходы для компонентов карты уровней
    - Улучшена реактивность и отзывчивость интерфейса
  - Компоненты оптимизированы:
    - `LevelMap` и `LevelCard` дополнены анимациями и переходами
    - Используется `cn` для conditionally применения классов
    - Добавлена задержка анимации для поочередного появления уровней
  Все изменения способствуют более плавному и приятному взаимодействию пользователя с картой уровней.
- **01.04.2025:** Выполнена задача 5.10 - Создание страницы Деталей Уровня (`/level/[levelId]`). Реализована следующая функциональность:
  - Создан файл `src/app/(routes)/level/[levelId]/page.tsx` с компонентом `LevelDetailPage`
  - Реализованы основные секции страницы:
    - Заголовок с названием уровня и кнопкой возврата на карту уровней
    - Блок описания уровня с информацией о развиваемых навыках и критериях завершения
    - Табы для отображения видео, тестов и артефактов
    - Карточки с видео-контентом и возможностью отметить их как просмотренные
    - Карточки с тестами и возможностью начать их прохождение
    - Плейсхолдер для будущих артефактов
    - Блок для завершения уровня с проверкой выполнения всех критериев
  - Интегрированы хуки из проекта:
    - `useLevel` - для получения данных о конкретном уровне
    - `useProgress` - для получения прогресса пользователя
    - `useNextLevel` - для определения следующего уровня
    - `useCompleteLevel` - для функционала завершения уровня
    - `useMarkVideoWatched` и `useMarkTestCompleted` - для маркировки видео и тестов
  - Добавлена обработка состояний:
    - Состояния загрузки с использованием skeleton-компонентов
    - Обработка ошибок с использованием toast-уведомлений
    - Различные состояния для просмотренных/непросмотренных видео
    - Различные состояния для пройденных/непройденных тестов
  - Реализован функционал завершения уровня:
    - Проверка выполнения всех критериев с использованием `canCompleteLevelCheck`
    - Кнопка завершения уровня с состоянием загрузки
    - Перенаправление на карту уровней после успешного завершения
  - Добавлены интерактивные элементы и улучшения UX:
    - Анимации переходов при загрузке и взаимодействии
    - Визуальная индикация статуса элементов (просмотрено, пройдено)
    - Адаптивный дизайн для всех размеров устройств
    - Информативные описания и подсказки
  Страница детального просмотра уровня полностью функциональна и предоставляет пользователю удобный и интуитивно понятный интерфейс для работы с учебными материалами уровня.

- **01.04.2025:** Выполнена задача 5.11 - Реализация отображения контента уровня. Реализована следующая функциональность:
  - Созданы компоненты для отображения контента уровня:
    - `src/components/features/Level/VideoSection.tsx` - компонент для отображения видео
    - `src/components/features/Level/TestSection.tsx` - компонент для отображения тестов
    - `src/components/features/Level/ArtifactSection.tsx` - компонент для отображения артефактов
    - `src/components/features/Level/index.ts` - для экспорта компонентов
  - Реализована функциональность в компонентах:
    - VideoSection: отображение списка видео с возможностью отметки просмотра
    - TestSection: отображение тестов с возможностью отметки прохождения
    - ArtifactSection: отображение артефактов с возможностью скачивания
  - Обновлен файл страницы уровня `src/app/(routes)/level/[levelId]/page.tsx`:
    - Интегрированы новые компоненты для отображения контента
    - Добавлена обработка хука `useMarkArtifactDownloaded`
    - Улучшен UI блока завершения уровня
  - Добавлена обработка различных состояний:
    - Просмотренные/непросмотренные видео
    - Пройденные/непройденные тесты
    - Скачанные/нескачанные артефакты
    - Состояния загрузки для всех действий
  
  Разделение функциональности на компоненты улучшило поддерживаемость кода и обеспечило более чистую архитектуру. Компоненты корректно интегрированы с хуками для обновления прогресса пользователя.

## Заметки о Текущих Проблемах и Решениях
- **01.04.2025:** Успешно инициализирован проект Next.js с использованием команды `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir`. Проект содержит все необходимые параметры: TypeScript, Tailwind CSS, ESLint, App Router, директорию src. Алиас @/* уже настроен в tsconfig.json. Проект успешно запускается командой `npm run dev`.
- **01.04.2025:** Установлены все необходимые зависимости для проекта с использованием команды `npm install firebase @tanstack/react-query react-hook-form zod @hookform/resolvers sonner`. Зависимости успешно добавлены в package.json. Установленные библиотеки:
  - firebase: для аутентификации, базы данных и хранилища
  - @tanstack/react-query: для управления состоянием данных и запросами
  - react-hook-form и zod: для управления формами и валидации
  - @hookform/resolvers: для интеграции zod с react-hook-form
  - sonner: для toast-уведомлений
- **01.04.2025:** Настроена библиотека компонентов shadcn/ui с использованием команды `npx shadcn@latest init`. Из-за проблем с установкой компонентов в React 19, компоненты были созданы вручную. Установлены и настроены необходимые компоненты:
  - Button: основная кнопка с различными вариантами
  - Card: компонент для отображения карточек с заголовком, содержимым и футером
  - Form: набор компонентов для создания форм с валидацией
  - Input: поле ввода
  - Checkbox: компонент для отметок
  - Select: выпадающий список
  - Dialog: компонент для модальных окон
  - Tabs: компонент для вкладок
  - Avatar: компонент для отображения аватаров пользователей
  - Toaster: компонент для интеграции с sonner для уведомлений
  - DropdownMenu: выпадающее меню для навигации
  - Progress: компонент для отображения прогресса
  Также настроены цвета в соответствии с бизнес-ориентированной темой (синие акценты).
- **01.04.2025:** Создана подробная документация по настройке проекта Firebase в консоли. Создан файл `docs/firebase-setup-guide.md` с пошаговыми инструкциями для:
  - Создания нового проекта Firebase с именем "BizLevel"
  - Настройки Authentication (Email/Password и опционально Google)
  - Создания Firestore Database в тестовом режиме
  - Настройки Storage для хранения файлов
  - Регистрации веб-приложения и получения конфигурационных ключей
  Конфигурационные ключи Firebase получены и сохранены для использования в задаче 1.5.
- **01.04.2025:** Создан файл `.env.local` в корне проекта с необходимыми переменными окружения для конфигурации Firebase:
  - NEXT_PUBLIC_FIREBASE_API_KEY
  - NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
  - NEXT_PUBLIC_FIREBASE_PROJECT_ID
  - NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
  - NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
  - NEXT_PUBLIC_FIREBASE_APP_ID
  - NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID
  Добавлена также закомментированная переменная OPENAI_API_KEY для будущего использования в чат-функционале. Создан дополнительный файл `docs/env-setup-guide.md` с подробными инструкциями по заполнению файла `.env.local` правильными значениями из Firebase Console.
- **01.04.2025:** Проверен и обновлен файл `.gitignore` для обеспечения безопасности конфиденциальных данных:
  - Добавлены специфические записи для всех локальных файлов окружения (`.env.local`, `.env.development.local`, `.env.test.local`, `.env.production.local`)
  - Добавлены записи для исключения файлов IDE/редакторов (`.vscode/`, `.idea/`, `*.swp`, `*.swo`)
  - Добавлены записи для исключения временных файлов операционной системы
  Это обеспечивает защиту конфиденциальных ключей Firebase и других чувствительных данных от случайной публикации в репозиторий.
- **01.04.2025:** Созданы файлы конфигурации Firebase для проекта:
  - `src/lib/firebase/config.ts`: Настроена инициализация Firebase с использованием переменных окружения из `.env.local`. Реализованы инициализации для основных сервисов Firebase: Authentication, Firestore и Storage.
  - `src/lib/firebase/index.ts`: Создан центральный файл для экспорта всех утилит Firebase. Подготовлена структура для будущих экспортов из auth.ts, firestore.ts и storage.ts, которые будут созданы в последующих задачах.
  Данная структура обеспечивает чистую и модульную организацию кода для работы с Firebase в проекте.
- **01.04.2025:** Созданы файлы с правилами безопасности для Firestore и Storage:
  - `firestore.rules`: Настроены базовые правила безопасности для Firestore, включая:
    - Запрет всего доступа по умолчанию
    - Разрешение чтения/записи в `users/{userId}` и `userProgress/{userId}` только для соответствующего пользователя
    - Разрешение чтения `levels`, `artifacts`, `faq` для всех аутентифицированных пользователей
    - Разрешение записи в `chats/{userId}/messages` только для соответствующего пользователя
    - Запрет прямого обновления `downloadCount` в `artifacts` пользователями
  - `storage.rules`: Настроены базовые правила безопасности для Storage, включая:
    - Запрет всего доступа по умолчанию
    - Разрешение чтения всех файлов для аутентифицированных пользователей
    - Разрешение записи (загрузки) только аутентифицированным пользователям в определенные папки (`artifacts/{artifactId}` и `avatars/{userId}`)
  Эти правила обеспечивают базовую защиту данных в Firebase, соответствующую требованиям проекта.
- **01.04.2025:** Создана базовая структура директорий проекта в соответствии с документацией:
  - Созданы основные директории App Router:
    - `src/app/(auth)` с подпапками `/login`, `/register`, `/reset-password` для страниц аутентификации
    - `src/app/(routes)` с подпапками `/map`, `/profile`, `/artifacts`, `/chat`, `/settings`, `/faq`, `/level/[levelId]` для основных страниц приложения
    - `src/app/api` для API маршрутов
  - Созданы директории для компонентов:
    - `src/components/auth` - компоненты для страниц аутентификации
    - `src/components/features` - компоненты, специфичные для функциональности
    - `src/components/layout` - компоненты макета
    - `src/components/ui` - базовые UI компоненты (уже существовала)
  - Созданы другие важные директории:
    - `src/context` - React контексты
    - `src/hooks` - кастомные React хуки
    - `src/lib/services` - сервисный слой для Firestore
    - `src/lib/utils` - общие утилиты
    - `src/types` - TypeScript типы и интерфейсы
  - Созданы базовые файлы-заглушки:
    - Обновлен `src/app/page.tsx` - корневая страница с редиректом на /map
    - `src/app/providers.tsx` - файл провайдеров с базовым Toaster
    - Созданы файлы макетов `src/app/(auth)/layout.tsx` и `src/app/(routes)/layout.tsx`
    - Созданы файлы утилит `src/lib/constants.ts` и `src/lib/zod-schemas.ts`
    - Создан файл с типами `src/types/index.ts`
    - Созданы базовые страницы `src/app/(routes)/map/page.tsx` и `src/app/(auth)/login/page.tsx`
  При создании директорий со специальными символами (скобки, квадратные скобки) использовалось экранирование символов для работы с терминалом. Структура полностью соответствует требованиям, описанным в документации проекта.
- **01.04.2025:** Настроен файл `src/app/providers.tsx` с необходимыми провайдерами:
  - Установлены зависимости `@tanstack/react-query` и `next-themes`
  - Настроен `QueryClientProvider` с базовыми настройками (отключен refetch при фокусе окна, ограничено количество повторных попыток)
  - Настроен `ThemeProvider` с поддержкой системной темы и плавных переходов
  - Сохранен существующий `Toaster` из sonner
  - Подготовлена структура для будущего добавления `AuthProvider` в следующих задачах
- **01.04.2025:** Обновлен корневой файл `src/app/layout.tsx`:
  - Импортирован и интегрирован компонент `Providers`
  - Обновлены метаданные страницы (title и description)
  - Установлен русский язык для HTML (`lang="ru"`)
  - Добавлен `suppressHydrationWarning` для предотвращения предупреждений при гидратации
  - Добавлены классы для минимальной высоты и фона
  - Сохранены существующие настройки шрифтов Geist
- **01.04.2025:** Создан файл `src/context/AuthContext.tsx` с контекстом аутентификации и провайдером:
  - Определен тип `AuthContextType` с необходимыми свойствами: `user` (пользователь из Firebase или null), `loading` (индикатор загрузки) и функциями для аутентификации (`login`, `register`, `logout`, `resetPassword`)
  - Создан контекст `AuthContext` с помощью `createContext` с начальным значением `null`
  - Создан хук `useAuthContext` для безопасного использования контекста (с проверкой на null и выбросом ошибки)
  - Реализован компонент `AuthProvider`, который:
    - Принимает `children` в props
    - Использует useState для хранения состояний `user` и `loading`
    - Включает заглушки для функций аутентификации (будут реализованы в задаче 2.3)
    - Возвращает `AuthContext.Provider` с объектом `value`, содержащим все необходимые состояния и функции
  Файл создан с директивой 'use client', что позволяет использовать его в клиентских компонентах Next.js.
- **01.04.2025:** Создан файл `src/lib/firebase/auth.ts` с базовыми функциями аутентификации:
  - Импортированы необходимые функции из Firebase Auth (onAuthStateChanged и другие)
  - Инициализирован объект auth с помощью функции getAuth()
  - Создана утилитная функция getCurrentUser(), которая возвращает Promise с текущим пользователем или null
  - Экспортирован объект auth для использования в других файлах
- **01.04.2025:** Обновлен файл `src/context/AuthContext.tsx` для мониторинга состояния аутентификации:
  - Добавлен импорт функции onAuthStateChanged из Firebase Auth и объекта auth из созданного файла auth.ts
  - Реализован хук useEffect для подписки на изменения состояния аутентификации с помощью onAuthStateChanged
  - Добавлена логика обновления состояний user и loading при изменении статуса аутентификации пользователя
  - Добавлена корректная очистка подписки при размонтировании компонента
  - Это позволяет автоматически отслеживать, аутентифицирован ли пользователь, без необходимости ручной проверки
- **01.04.2025:** Обновлен файл `src/lib/firebase/index.ts` - раскомментирован экспорт из auth.ts, чтобы сделать функции аутентификации доступными через центральный экспорт firebase.
- **01.04.2025:** Обновлен файл `src/lib/firebase/auth.ts` с основными функциями аутентификации:
  - Добавлены функции `loginWithEmailAndPassword`, `registerWithEmailAndPassword`, `logout`, `resetPassword` и `updateUserProfile`
  - Каждая функция должным образом типизирована с использованием типов из Firebase Auth
  - Все функции возвращают Promise с соответствующими типами данных
  - Добавлены JSDoc комментарии для улучшения документации и автодополнения в IDE
- **01.04.2025:** Обновлен файл `src/context/AuthContext.tsx` с реализацией аутентификационных функций:
  - Реализованы функции `login`, `register`, `logout`, `resetPassword` и добавлена новая функция `updateProfile`
  - Обновлен тип `AuthContextType` с добавлением поля `error` для хранения ошибок аутентификации и функции `updateProfile`
  - Добавлена система обработки ошибок Firebase с преобразованием их в понятные пользователю сообщения на русском языке
  - Создана карта соответствия кодов ошибок Firebase (`FirebaseAuthErrorMessages`) их русскоязычным описаниям
  - В каждой функции реализована корректная обработка состояний загрузки (loading) и ошибок (error)
  - Во всех функциях используется правильная обработка исключений (try/catch/finally)
  - Все функции правильно прокидывают исключения наверх для возможности их обработки в UI компонентах
- **01.04.2025:** Обновлен файл `src/app/providers.tsx` с интеграцией `AuthProvider`:
  - Импортирован компонент `AuthProvider` из `@/context/AuthContext`
  - Добавлен `AuthProvider` в цепочку провайдеров с правильным порядком вложенности:
    - `QueryClientProvider` (самый внешний) - для работы React Query
    - `AuthProvider` - для управления состоянием аутентификации на уровне всего приложения
    - `ThemeProvider` - для управления темой приложения
    - `Toaster` - для отображения уведомлений (на том же уровне, что и children)
  - Эта структура вложенности позволяет:
    - `AuthProvider` получать доступ к функциям React Query для выполнения запросов
    - Другим компонентам приложения получать доступ к контексту аутентификации
    - Обеспечить корректную работу всех зависимых компонентов
  - Теперь функциональность аутентификации доступна во всем приложении через хук `useAuthContext`
- **01.04.2025:** Создан файл `src/hooks/useAuth.ts` с хуком для работы с аутентификацией:
  - Создана директория `src/hooks` для хранения всех кастомных хуков в приложении
  - Реализован экспортируемый хук `useAuth`, который является оберткой над `useAuthContext`
  - Хук предоставляет доступ ко всем свойствам и функциям аутентификации:
    - `user` - текущий аутентифицированный пользователь (или null)
    - `loading` - состояние загрузки
    - `error` - текущая ошибка аутентификации (если есть)
    - `login` - функция для входа пользователя
    - `register` - функция для регистрации пользователя
    - `logout` - функция для выхода пользователя
    - `resetPassword` - функция для сброса пароля
    - `updateProfile` - функция для обновления профиля пользователя
  - Добавлена дополнительная проверка на существование контекста
  - Добавлена подробная JSDoc документация с примером использования хука
  - Этот хук будет основным способом доступа к функциям аутентификации во всем приложении, что упрощает управление состоянием аутентификации и делает код более читаемым
- **01.04.2025:** Обновлен файл `src/app/(auth)/layout.tsx` для создания макета страниц аутентификации:
  - Добавлена директива 'use client' для использования клиентской функциональности
  - Использован хук `useAuth` для получения текущего пользователя и состояния загрузки
  - Реализована логика перенаправления: если пользователь аутентифицирован, происходит редирект на страницу `/map`
  - Добавлен индикатор загрузки с анимацией, который отображается во время проверки состояния аутентификации
  - Создан улучшенный дизайн макета:
    - Добавлен заголовок с названием приложения "BizLevel" и кратким описанием
    - Использован фон светло-серого цвета (bg-slate-100) для отличия от основного приложения
    - Создана центрированная карточка для форм с тенью и закругленными углами
    - Добавлен футер с копирайтом и текущим годом
  - Макет адаптирован для размещения страниц входа, регистрации и сброса пароля
  - Макет полностью адаптивен и корректно отображается на разных устройствах
- **01.04.2025:** Созданы базовые страницы аутентификации:
  - Обновлена страница `src/app/(auth)/login/page.tsx`:
    - Добавлены метаданные с заголовком "Вход | BizLevel"
    - Создан placehoder для формы входа (будет реализована в следующей задаче)
    - Добавлены ссылки на страницы регистрации и сброса пароля
    - Добавлена информация о платформе BizLevel
  - Создана страница `src/app/(auth)/register/page.tsx`:
    - Добавлены метаданные с заголовком "Регистрация | BizLevel"
    - Создан placeholder для формы регистрации
    - Добавлена ссылка на страницу входа
    - Добавлена информация о преимуществах регистрации на платформе
  - Создана страница `src/app/(auth)/reset-password/page.tsx`:
    - Добавлены метаданные с заголовком "Сброс пароля | BizLevel"
    - Создан placeholder для формы сброса пароля
    - Добавлена ссылка на страницу входа
    - Добавлены подробные инструкции по процессу сброса пароля
  - Все страницы используют единый стиль и визуально согласованы между собой
  - Добавлена навигация между страницами аутентификации
  - Использованы компоненты из созданного ранее макета для страниц аутентификации
  - Реализован адаптивный дизайн, который хорошо выглядит на разных устройствах
- **01.04.2025:** Реализованы компоненты форм аутентификации:
  - Создан файл `src/lib/zod-schemas.ts` с схемами валидации для форм:
    - `loginFormSchema`: валидация email (формат email) и password (минимум 6 символов)
    - `registerFormSchema`: валидация email, password и passwordConfirm (совпадение с password)
    - `resetPasswordFormSchema`: валидация email (формат email)
  - Создан компонент `src/components/auth/LoginForm.tsx`:
    - Использованы React Hook Form и Zod для валидации
    - Интеграция с хуком `useAuth` для выполнения входа
    - Обработка состояний загрузки и ошибок
    - Визуальная стилизация с использованием shadcn/ui компонентов
  - Создан компонент `src/components/auth/RegisterForm.tsx`:
    - Все поля из схемы валидации с соответствующими проверками
    - Интеграция с `register` методом из `useAuth`
    - Автоматическое создание displayName из email
    - Обработка загрузки и ошибок
  - Создан компонент `src/components/auth/ResetPasswordForm.tsx`:
    - Поле email с валидацией
    - Интеграция с `resetPassword` методом из `useAuth`
    - Отображение сообщения об успешной отправке письма
    - Возможность повторной отправки письма
  - Создан дополнительный компонент `src/components/ui/alert.tsx` для сообщений об успешных операциях
  - Все компоненты форм полностью адаптивны и следуют единому стилю проекта
  - Обновлены страницы аутентификации для использования созданных компонентов форм
  - Реализовано перенаправление пользователя на страницу `/map` после успешной аутентификации
- **01.04.2025:** Реализована логика защиты роутов:
  - Обновлен файл `src/app/(routes)/layout.tsx`:
    - Интегрирован компонент `MainLayout` из задачи 3.1
    - Импортирован компонент `MainLayout` из `@/components/layout/MainLayout`
    - Содержимое (children) обернуто в компонент `MainLayout`
    - Сохранена логика защиты роутов для неаутентифицированных пользователей
    - Сохранен порядок проверки аутентификации:
      1. Проверка аутентификации
      2. Редирект неаутентифицированных пользователей
      3. Отображение содержимого в компоненте `MainLayout` для аутентифицированных пользователей
    - Заменен временный контейнер на полноценный макет с Sidebar и Header
    - Все страницы основного приложения теперь используют единый макет с навигацией
  - Защита роутов работает следующим образом:
    - При попытке доступа к защищенному маршруту проверяется состояние аутентификации
    - Во время проверки отображается индикатор загрузки
    - Если пользователь не аутентифицирован, происходит автоматический редирект на страницу входа
    - Если пользователь аутентифицирован, отображается запрошенная страница
  - Реализованный механизм защиты роутов обеспечивает безопасный доступ к функциональности приложения и улучшает UX за счет использования индикатора загрузки
- **01.04.2025:** Реализована система редиректов для аутентифицированных/неаутентифицированных пользователей:
  - Создан файл утилит `src/lib/utils/auth-redirect.ts` с функциями для работы с редиректами:
    - `saveRedirectUrl`: сохраняет URL для последующего редиректа в localStorage
    - `getRedirectUrl`: получает сохраненный URL из localStorage
    - `clearRedirectUrl`: удаляет сохраненный URL из localStorage
    - `createAuthUrlWithRedirect`: создает URL для страницы аутентификации с параметром redirect
    - `getRedirectFromUrl`: извлекает URL редиректа из параметров текущего URL
  - Создан компонент `src/components/auth/RedirectGuard.tsx`:
    - Обертка для компонентов, управляющая перенаправлением пользователя в зависимости от статуса аутентификации
    - Позволяет защищать отдельные участки интерфейса без перенаправления всей страницы
    - Показывает индикатор загрузки во время проверки статуса аутентификации
  - Обновлен корневая страница `src/app/page.tsx`:
    - Использует серверный компонент Next.js для определения статуса аутентификации
    - Проверяет наличие кук Firebase Auth для определения статуса аутентификации
    - Перенаправляет на `/map` аутентифицированных пользователей и на `/login` неаутентифицированных
  - Обновлены формы аутентификации:
    - `LoginForm` и `RegisterForm` учитывают параметр redirect в URL
    - После успешного входа/регистрации пользователь перенаправляется на сохраненный URL
    - Добавлена логика для получения URL редиректа из разных источников (URL параметры, localStorage)
  - Обновлены макеты для аутентификации и защищенных маршрутов:
    - `(auth)/layout.tsx` перенаправляет аутентифицированных пользователей на сохраненный URL
    - `(routes)/layout.tsx` сохраняет текущий URL перед перенаправлением на страницу входа
  - Реализованная система обеспечивает:
    - Корректную навигацию между защищенными и публичными страницами
    - Сохранение URL страницы, с которой пользователь был перенаправлен
    - Возврат пользователя на исходную страницу после успешной аутентификации
    - Гибкую настройку поведения редиректов
- **01.04.2025:** Реализован механизм создания записи пользователя в Firestore при регистрации:
  - Создан файл `src/lib/firebase/firestore.ts` с базовыми утилитами для работы с Firestore:
    - `getDocumentById`: функция для получения документа из коллекции по ID
    - `saveDocument`: функция для сохранения документа в коллекцию
    - `updateDocument`: функция для обновления существующего документа
    - `createUserDocument`: функция для создания документа пользователя в коллекции users
    - Определен интерфейс `UserDocument` с полями для хранения данных пользователя
  - Обновлен файл `src/lib/firebase/auth.ts`:
    - Расширена функция `registerWithEmailAndPassword` для создания документа пользователя после успешной регистрации
    - Добавлена обработка ошибок при создании документа пользователя
    - Добавлены подробные JSDoc-комментарии для улучшения документации функций
  - Обновлен файл `src/lib/firebase/index.ts`:
    - Раскомментирован экспорт из `firestore.ts`
    - Обновлен комментарий, указывающий что Firestore утилиты реализованы в задаче 2.11
  - Реализованная структура данных пользователя в Firestore:
    - email: электронная почта пользователя
    - displayName: имя пользователя (может быть null)
    - photoURL: URL фотографии пользователя (может быть null)
    - createdAt: временная метка создания документа
    - updatedAt: временная метка последнего обновления документа
    - settings: объект с настройками пользователя:
      - theme: предпочитаемая тема интерфейса ('light', 'dark', 'system')
      - notifications: включены ли уведомления
      - emailNotifications: включены ли email-уведомления
  - Теперь при регистрации нового пользователя в Firebase Authentication автоматически создается запись в коллекции `users` в Firestore
  - Эта запись будет использоваться для хранения дополнительных данных о пользователе, которые не могут быть сохранены в Firebase Authentication
- **01.04.2025 (Задача 4.1):** Создан сервисный слой для работы с настройками пользователя в файле `src/lib/services/settings-service.ts`:
  - Определены интерфейсы:
    - `UserSettings`: содержит настройки темы (`theme`: 'light' | 'dark' | 'system'), настройки уведомлений (`notificationsEnabled`: boolean) и настройки email-уведомлений (`emailNotificationsEnabled`: boolean).
    - `UserProfile`: содержит расширенную информацию о пользователе, включая `displayName`, `photoURL`, `email`, `createdAt`, `updatedAt` и `settings` (типа UserSettings).
  - Реализованы функции:
    - `getUserSettings(userId: string)`: получает документ пользователя из Firestore и возвращает настройки пользователя.
    - `updateUserSettings(userId: string, settings: Partial<UserSettings>)`: обновляет настройки пользователя в Firestore.
    - `getUserProfile(userId: string)`: получает полный профиль пользователя из Firestore.
    - `updateUserProfile(userId: string, profileData: Partial<UserProfile>)`: обновляет профиль пользователя в Firestore.
  - Все функции включают:
    - Корректную обработку ошибок с использованием try/catch.
    - Преобразование данных между форматом хранения в Firestore и интерфейсами, используемыми в приложении.
    - Типизацию входных и выходных параметров.
  - Для взаимодействия с Firestore использованы уже существующие утилиты из `src/lib/firebase/firestore.ts`.
  - Сервисный слой предоставляет единый интерфейс для работы с данными пользователя в приложении, абстрагируя логику доступа к базе данных от компонентов пользовательского интерфейса.
- **01.04.2025 (Задача 4.2):** Создан файл `src/hooks/useSettings.ts` с хуками для работы с настройками пользователя:
  - Реализован хук `useSettings`:
    - Использует `useQuery` из `@tanstack/react-query` для получения настроек пользователя
    - Получает `userId` из параметра или из контекста аутентификации (если параметр не передан)
    - Правильно обрабатывает состояния загрузки и ошибок
    - Использует функцию `getUserSettings` из `settings-service.ts`
    - Включает кеширование данных (staleTime: 5 минут)
    - Возвращает объект с данными настроек и состоянием запроса
  - Реализован хук `useUpdateSettings`:
    - Использует `useMutation` для обновления настроек пользователя
    - При успешном обновлении инвалидирует соответствующие запросы в кэше React Query
    - Показывает toast-уведомления об успехе или ошибке операции
    - Корректно обрабатывает случай, когда пользователь не аутентифицирован
  - Дополнительно реализованы хуки для работы с полным профилем пользователя:
    - `useUserProfile`: для получения профиля с использованием `useQuery`
    - `useUpdateUserProfile`: для обновления профиля с использованием `useMutation`
  - Все хуки имеют типизацию входных и выходных параметров
  - Добавлены подробные JSDoc комментарии для улучшения документации
  - Реализована директива 'use client' для использования в клиентских компонентах
  - Реализовано взаимодействие между кэшами данных профиля и настроек при обновлении
- **01.04.2025 (Задача 4.3):** Создана страница профиля пользователя:
  - Создан файл `src/app/(routes)/profile/page.tsx` с клиентским компонентом `ProfilePage`
  - Создан файл `src/app/(routes)/profile/layout.tsx` с метаданными страницы (title, description)
  - Реализованы три основных блока информации:
    - Блок личной информации пользователя: аватар, имя, email, дата регистрации
    - Блок прогресса обучения с визуализацией пройденных уровней
    - Блок статистики навыков с прогресс-барами для каждого навыка
  - Интегрирован хук `useUserProfile` для получения информации о профиле пользователя
  - Добавлена функция `getInitials` для генерации инициалов при отсутствии аватара
  - Создан файл `src/lib/utils/date-utils.ts` с функциями для форматирования дат:
    - `formatDate`: форматирует дату в русском формате (ДД месяц ГГГГ)
    - `formatDateTime`: добавляет время к отформатированной дате
    - `getRelativeTimeString`: возвращает относительные даты (сегодня, вчера, N дней назад)
  - Добавлена корректная обработка состояний загрузки и ошибок
  - Реализованы заглушки для данных прогресса (будут заменены реальными данными в следующих задачах)
  - Использованы компоненты из shadcn/ui: Card, Avatar, Progress и другие
  - Реализован адаптивный дизайн с использованием Tailwind CSS (десктоп и мобильные устройства)
  - Использованы цвета и стили, соответствующие общему дизайну приложения
- **01.04.2025 (Задача 4.4):** Созданы компоненты для отображения информации о пользователе на странице профиля:
  - Создана директория `src/components/features/profile/` с тремя компонентами:
    - `UserInfoCard.tsx`: Отображает информацию о пользователе (аватар, имя, email, дата регистрации) и кнопку редактирования профиля (пока без функциональности)
    - `ProgressSummary.tsx`: Отображает прогресс обучения пользователя с заглушками для данных (количество пройденных уровней, процент выполнения, список уровней)
    - `SkillsStatistics.tsx`: Отображает статистику навыков пользователя с заглушками для данных (список навыков с прогресс-барами)
  - Рефакторинг страницы профиля `src/app/(routes)/profile/page.tsx`:
    - Заменены встроенные блоки на импортированные компоненты
    - Передача данных профиля в компонент `UserInfoCard`
    - Подготовка для будущей интеграции реальных данных о прогрессе и навыках
  - Реализованы пропсы с типизацией для всех компонентов, что облегчит их интеграцию с реальными данными в будущем
  - Добавлена кнопка редактирования профиля с иконкой карандаша (будет реализована в следующих задачах)
  - Все компоненты используют общий стиль и компоненты из shadcn/ui для согласованного вида
  - Код стал более модульным и поддерживаемым, с четким разделением ответственности между компонентами
- **01.04.2025 (Задача 4.5):** Создана страница настроек пользователя:
  - Создан файл `src/app/(routes)/settings/page.tsx` с клиентским компонентом `SettingsPage`.
  - Создан файл `src/app/(routes)/settings/layout.tsx` с метаданными страницы (title, description).
  - Реализована страница с использованием компонента Tabs из shadcn/ui для разных категорий настроек:
    - Профиль: для настроек личных данных пользователя
    - Внешний вид: для настроек темы и отображения
    - Уведомления: для настроек системы уведомлений
    - Аккаунт: для настроек аккаунта и смены пароля
  - Подготовлена структура для передачи данных в формы настроек (заготовки для следующих задач).
  - Реализована интеграция с хуком `useSettings` для получения данных настроек пользователя.
  - Добавлены состояния загрузки при получении данных настроек.
  - На данном этапе формы еще не реализованы (согласно заданию, они будут созданы в следующей задаче).
  - Использованы компоненты Card и Tabs из библиотеки shadcn/ui для создания согласованного дизайна.
  - Адаптивный дизайн страницы, который хорошо выглядит как на десктопных, так и на мобильных устройствах.
- **01.04.2025 (Задача 4.6):** Реализованы формы для изменения настроек пользователя:
  - Создан файл `src/lib/firebase/storage.ts` с функциями для работы с Firebase Storage:
    - `uploadFile`: общая функция для загрузки файлов
    - `uploadAvatar`: специализированная функция для загрузки аватаров пользователей
    - `deleteFile`: функция для удаления файлов
  - Обновлен файл `src/lib/firebase/index.ts` для экспорта функций из storage.ts
  - В файл `src/lib/zod-schemas.ts` добавлены схемы валидации для форм настроек:
    - `appearanceSettingsSchema`: для настроек темы
    - `notificationSettingsSchema`: для настроек уведомлений
    - `accountSettingsSchema`: для настроек аккаунта
  - Созданы компоненты форм в директории `src/components/features/settings/`:
    - `ProfileSettingsForm.tsx`: форма для редактирования личных данных (имя, аватар)
      - Реализован функционал загрузки фото в Firebase Storage
      - Добавлен предпросмотр аватара перед загрузкой
      - Реализована проверка типа и размера файла
      - Добавлена возможность сохранения имени пользователя
    - `AppearanceSettingsForm.tsx`: форма для выбора темы (светлая, темная, системная)
    - `NotificationSettingsForm.tsx`: форма с переключателями для настроек уведомлений
    - `AccountSettingsForm.tsx`: форма с функционалом сброса пароля и информацией об email
  - Обновлена страница настроек `src/app/(routes)/settings/page.tsx` для интеграции созданных форм
  - Все формы используют React Hook Form и Zod для валидации данных
  - Реализовано взаимодействие с хуками:
    - `useSettings`/`useUpdateSettings` для работы с настройками
    - `useUserProfile`/`useUpdateUserProfile` для работы с профилем
    - `useAuth` для функций аутентификации
  - Добавлена обратная связь для пользователя через toast-уведомления:
    - Уведомления об успешном сохранении настроек
    - Уведомления об ошибках при загрузке/сохранении
  - Формы отображают актуальное состояние загрузки данных и индикаторы выполнения операций
  - Добавлена проверка на оптимальное качество пользовательского опыта:
    - Загруженные файлы имеют уникальные имена на основе userId и временной метки
    - Переключатель email-уведомлений отключен, если не включены основные уведомления
    - При загрузке аватара показывается предпросмотр без ожидания полной загрузки
- **01.04.2025 (Задача 4.7):** Интегрирован хук `useSettings` для загрузки и сохранения настроек пользователя:
  - Создан файл `src/context/SettingsContext.tsx` с контекстом настроек пользователя:
    - Реализован компонент `SettingsProvider` для управления глобальными настройками
    - Добавлены функции `updateTheme`, `updateNotifications` и `updateEmailNotifications`
    - Реализовано автоматическое применение темы из настроек пользователя
  - Создан хук `src/hooks/useSettingsContext.ts` для удобного доступа к контексту настроек
  - Обновлен хук `useSettings` для автоматической загрузки и обновления настроек:
    - Добавлена автоматическая инвалидация кэша при смене пользователя
    - Улучшена обработка состояний загрузки с учетом состояния аутентификации
    - Добавлена поддержка useEffect для обновления при изменении user
  - Интегрирован `SettingsProvider` в цепочку провайдеров в `src/app/providers.tsx`:
    - `QueryClientProvider` -> `AuthProvider` -> `SettingsProvider` -> `ThemeProvider`
    - Обеспечена правильная последовательность инициализации контекстов
  - Обновлены компоненты форм настроек для использования контекста:
    - `AppearanceSettingsForm.tsx` - использует `updateTheme` из контекста
    - `NotificationSettingsForm.tsx` - использует `updateNotifications` и `updateEmailNotifications`
  - Создан компонент `ThemeToggle.tsx` для быстрого переключения темы в интерфейсе:
    - Добавлена поддержка всех трех режимов: светлый, темный и системный
    - Интегрирован в компонент `Header.tsx` для удобного доступа из любой страницы
  - Реализована синхронизация между ThemeProvider и настройками пользователя:
    - Тема автоматически применяется при загрузке настроек
    - При изменении темы через UI она сохраняется в Firestore
  Все изменения обеспечивают полностью работающую систему настроек с сохранением предпочтений пользователя между сеансами, автоматической загрузкой при входе и удобным управлением через UI.
- **01.04.2025 (Задача 5.1):** Определены основные TypeScript типы для проекта:
  - Обновлен файл `src/types/index.ts` с добавлением и редактированием необходимых типов и интерфейсов:
    - Добавлены перечисления (enums):
      - `SkillType`: Marketing, Finance, Management, Leadership, Communication, Sales
      - `LevelStatus`: Locked, Available, Completed
    - Обновлены и добавлены интерфейсы:
      - `User`: структура пользователя с полями id, email, displayName, photoURL, createdAt, settings
      - `UserSettings`: настройки пользователя с полями theme, notificationsEnabled, emailNotificationsEnabled
      - `UserProgress`: прогресс пользователя с полями userId, currentLevelId, completedLevelIds, watchedVideoIds, completedTestIds, downloadedArtifactIds, skillProgress, badges, lastUpdated
      - `Badge`: структура значка с полями id, title, description, imageUrl, earnedAt
      - `Level`: структура уровня с полями id, title, description, order, videoContent, tests, relatedArtifactIds, completionCriteria, skillFocus
      - `VideoContent`: структура видео с полями id, title, url, duration, watched
      - `Test`: структура теста с полями id, title, questions, completed
      - `Question`: структура вопроса с полями id, text, type, options, correctAnswer
      - `CompletionCriteria`: критерии завершения уровня с полями videosRequired, testsRequired
      - `Artifact`: структура артефакта с полями id, title, description, fileURL, fileName, fileType, levelId, downloadCount, uploadedAt, downloaded
    - Добавлен вспомогательный тип `LevelWithStatus`: объединение типа Level и { status: LevelStatus }
    - Сохранен существующий интерфейс `ChatMessage` для чата
  - При реализации типов учтены следующие особенности:
    - Для `SkillType` использован именованный enum для упрощения типизации в коде
    - Поля `watched`, `completed` и `downloaded` отмечены как необязательные (?) и помечены комментарием как client-side properties
    - Тип `Question` теперь поддерживает три типа вопросов: 'multiple-choice', 'single-choice', 'text'
    - Для `skillProgress` используется Record с типом SkillType в качестве ключа
    - `skillFocus` в типе Level изменен с Record на массив SkillType
  - Проверена совместимость типов с существующим кодом
- **01.04.2025 (Задача 5.2):** Расширен файл `src/lib/firebase/firestore.ts` с базовыми утилитами для работы с Firestore:
  - Добавлены константы для имен коллекций:
    - `USERS_COLLECTION = 'users'`
    - `USER_PROGRESS_COLLECTION = 'userProgress'`
    - `LEVELS_COLLECTION = 'levels'`
    - `ARTIFACTS_COLLECTION = 'artifacts'`
    - `FAQ_COLLECTION = 'faq'`
    - `CHATS_COLLECTION = 'chats'`
    - `MESSAGES_SUBCOLLECTION = 'messages'`
  - Обновлены и добавлены базовые функции для работы с документами:
    - `getDocumentById<T>`: получение документа по ID с типизацией
    - `getDocuments<T>`: получение списка документов с поддержкой фильтрации через QueryConstraint
    - `createDocument<T>`: создание нового документа с автоматической генерацией ID или использованием переданного ID
    - `saveDocument<T>`: сохранение документа с заданным ID
    - `updateDocument<T>`: обновление полей существующего документа
    - `deleteDocument`: удаление документа из коллекции
  - Добавлены функции для работы с коллекциями и подколлекциями:
    - `getCollectionSnapshot`: получение снимка коллекции (QuerySnapshot)
    - `getSubcollectionDocuments<T>`: получение документов из подколлекции
  - Добавлены специальные утилиты для работы с Firestore:
    - `arrayUnionItem`: добавление элемента в массив
    - `arrayRemoveItem`: удаление элемента из массива
    - `incrementCounter`: инкрементирование счетчика
    - `batchWrite`: выполнение пакетной операции для атомарных транзакций
  - Добавлены утилиты для конвертации данных:
    - `convertTimestampToDate<T>`: преобразование Firestore Timestamp в JavaScript Date
    - `convertDateToTimestamp<T>`: преобразование JavaScript Date в Firestore Timestamp
  - Все функции имеют полную типизацию с использованием TypeScript generics
  - Добавлена обработка ошибок для всех функций с логированием и проброской исключений
  - Обновлена функция `createUserDocument` для использования константы `USERS_COLLECTION`
  - Унифицированы параметры во всех функциях для обеспечения единого стиля кода (использование `collectionName` вместо `collection`)
  - Исправлены проблемы с конфликтом имен функций и параметров (например, `collection` как параметр и как функция из Firestore)
  - Все функции поддерживают каскадное преобразование Timestamp/Date для вложенных полей
- **01.04.2025 (Задача 5.3):** Создан сервисный слой для работы с прогрессом пользователя в Firestore:
  - Создан файл `src/lib/services/progress-service.ts` с функциями для работы с прогрессом пользователя:
    - `initializeUserProgress(userId: string)`: инициализация начального прогресса для нового пользователя
      - Устанавливает currentLevelId = 'level-1', пустые массивы для completedLevelIds, watchedVideoIds, completedTestIds, downloadedArtifactIds
      - Инициализирует skillProgress с нулевыми значениями для всех типов навыков
      - Создает пустой массив badges
    - `getUserProgress(userId: string)`: получение прогресса пользователя из Firestore
    - `markVideoWatched(userId: string, videoId: string)`: отметка видео как просмотренного
      - Использует arrayUnionItem для добавления видео в watchedVideoIds без дубликатов
      - Обновляет lastUpdated
    - `markTestCompleted(userId: string, testId: string)`: отметка теста как пройденного
      - Использует arrayUnionItem для добавления теста в completedTestIds без дубликатов
      - Обновляет lastUpdated
    - `markArtifactDownloaded(userId: string, artifactId: string)`: отметка артефакта как скачанного
      - Использует arrayUnionItem для добавления артефакта в downloadedArtifactIds без дубликатов
      - Увеличивает счетчик скачиваний в документе артефакта
      - Обновляет lastUpdated
    - `completeLevel(userId: string, levelId: string, nextLevelId: string)`: завершение уровня
      - Добавляет levelId в completedLevelIds
      - Устанавливает currentLevelId = nextLevelId
      - Вызывает checkAndAwardBadges для проверки и выдачи значков
      - Обновляет lastUpdated
    - `checkAndAwardBadges(userId: string, userProgress: UserProgress)`: проверка и выдача значков
      - Реализована базовая логика для выдачи значка "Первый уровень пройден"
      - Подготовлена структура для добавления новых типов значков в будущем
    - `isLevelAvailable(userProgress: UserProgress, levelId: string)`: проверка доступности уровня
      - Определяет, доступен ли уровень пользователю (текущий или пройденный)
  - Все функции используют хелперы из `firestore.ts` для работы с Firestore:
    - `getDocumentById`, `saveDocument`, `updateDocument` для основных операций с документами
    - `arrayUnionItem` для добавления элементов в массивы без дубликатов
    - `incrementCounter` для увеличения счетчика скачиваний артефактов
  - Добавлена подробная обработка ошибок и логирование для всех функций
  - Все функции типизированы с использованием типов из `src/types/index.ts`
  - Реализована проверка существования документа прогресса пользователя перед инициализацией
  - В функции `completeLevel` добавлена проверка существования прогресса пользователя
- **01.04.2025 (Задача 5.4):** Создан сервисный слой для работы с уровнями в файле `src/lib/services/level-service.ts`. Реализованы следующие функции:
  - `getLevels()` - получение всех уровней с сортировкой по полю order
  - `getLevelById(levelId)` - получение информации о конкретном уровне
  - `getLevelsWithStatus(userProgress)` - получение уровней с определением их статуса (доступен, заблокирован, завершен)
  - `getNextLevelId(currentLevelId)` - получение ID следующего уровня
  - `isLevelCompleted(userProgress, levelId)` - проверка, завершен ли уровень
- **01.04.2025:** Выполнена задача 5.5 - Создан хук `useProgress` для работы с прогрессом пользователя в файле `src/hooks/useProgress.ts`. Реализована следующая функциональность:
  - Основной хук `useProgress` - получение и инициализация прогресса пользователя с использованием React Query
  - Мутации для обновления прогресса: `useMarkVideoWatched`, `useMarkTestCompleted`, `useMarkArtifactDownloaded` и `useCompleteLevel`
  - Вспомогательные функции для проверки состояний: `isVideoWatched`, `isTestCompleted`, `isArtifactDownloaded`, `isLevelCompleted` и `canCompleteLevelCheck`
  - Интеграция с toast-уведомлениями при успешных и неуспешных мутациях
  - Автоматическая инвалидация кэша при успешных мутациях
- **01.04.2025:** Выполнена задача 5.6 - Созданы хуки для работы с уровнями в файле `src/hooks/useLevels.ts`. Реализована следующая функциональность:
  - Хук `useLevels` - получение списка всех уровней
  - Хук `useLevel` - получение информации о конкретном уровне по ID
  - Хук `useLevelsWithStatus` - получение уровней с их статусом (на основе прогресса пользователя)
  - Хук `useNextLevel` - получение информации о следующем уровне
  - Интеграция с toast-уведомлениями для обработки ошибок
  - Оптимизация кеширования с использованием staleTime
- **01.04.2025:** Выполнена задача 5.7 - Создана страница Карты Уровней (`/map`) в файле `src/app/(routes)/map/page.tsx`. Реализована следующая функциональность:
  - Клиентский компонент с использованием хуков `useLevelsWithStatus` и `useProgress`
  - Отображение общего прогресса пользователя (количество пройденных уровней и процент)
  - Реализация состояний загрузки (skeleton loaders) для улучшения UX
  - Placeholder для будущего компонента `LevelMap`
  - Информация о текущем уровне пользователя
  - Добавлен файл `metadata.ts` для SEO-оптимизации
- **01.04.2025:** Выполнена задача 5.8 - Реализован компонент `LevelMap` для визуализации карты уровней с интерактивными элементами. Реализована следующая функциональность:
  - Созданы файлы:
    - `src/components/features/LevelMap/LevelMap.tsx` - основной компонент карты уровней
    - `src/components/features/LevelMap/LevelCard.tsx` - компонент для отображения отдельного уровня
    - `src/components/features/LevelMap/index.ts` - для экспорта компонентов
  - Компонент `LevelMap`:
    - Принимает пропсы: `levels`, `isLoading`, `onLevelClick`
    - Отображает вертикальную дорожку из уровней с соединительными линиями
    - Адаптивный дизайн с различными представлениями для десктопа и мобильных устройств
    - Отображает скелетон при загрузке данных
  - Компонент `LevelCard`:
    - Визуально отображает статус уровня (заблокирован, доступен, пройден)
    - Отображает номер/порядок уровня, название и статус текстом
    - Имеет различные стили и иконки в зависимости от статуса (замок для заблокированных, галочка для пройденных)
    - Обрабатывает клики только для доступных и пройденных уровней
  - Обновлена страница `/map` для использования компонента `LevelMap`:
    - Добавлен импорт `LevelMap` и заменен placeholder
    - Добавлен обработчик клика для перехода к странице уровня
    - Добавлена передача данных из хука `useLevelsWithStatus`
  Компонент реализован в соответствии с заданием и имеет современный дизайн, адаптированный для бизнес-аудитории.
- **01.04.2025:** Выполнена задача 5.9 - Интеграция `useLevels` и `useProgress` в компонент `LevelMap` для отображения актуальных данных. Реализована следующая функциональность:
  - Создан компонент `ProgressSummary` в `src/components/features/LevelMap/ProgressSummary.tsx`:
    - Отображает прогресс прохождения уровней с использованием компонента `Progress` из shadcn/ui
    - Показывает количество пройденных уровней из общего числа
    - Имеет состояние загрузки с использованием `Skeleton`
    - Использует плавные анимации перехода между состояниями
  - Улучшен обработчик клика по уровню в `src/app/(routes)/map/page.tsx`:
    - Добавлена проверка статуса уровня перед переходом на страницу уровня
    - Для заблокированных уровней добавлено отображение toast-уведомления с информацией о необходимости прохождения предыдущих уровней
    - Обработчик оптимизирован с использованием `useCallback`
  - Добавлена обработка ошибок загрузки данных:
    - Использовано уведомление toast при возникновении ошибок
    - Добавлен `useEffect` для отслеживания изменений в состоянии ошибок
  - Добавлены плавные анимации и улучшен UX:
    - Реализована анимация `fadeIn` для плавного появления содержимого страницы
    - Добавлены переходы при наведении на элементы
    - Улучшены CSS-переходы для компонентов карты уровней
    - Улучшена реактивность и отзывчивость интерфейса
  - Компоненты оптимизированы:
    - `LevelMap` и `LevelCard` дополнены анимациями и переходами
    - Используется `cn` для conditionally применения классов
    - Добавлена задержка анимации для поочередного появления уровней
  Все изменения способствуют более плавному и приятному взаимодействию пользователя с картой уровней.
- **01.04.2025:** Выполнена задача 5.10 - Создание страницы Деталей Уровня (`/level/[levelId]`). Реализована следующая функциональность:
  - Создан файл `src/app/(routes)/level/[levelId]/page.tsx` с компонентом `LevelDetailPage`
  - Реализованы основные секции страницы:
    - Заголовок с названием уровня и кнопкой возврата на карту уровней
    - Блок описания уровня с информацией о развиваемых навыках и критериях завершения
    - Табы для отображения видео, тестов и артефактов
    - Карточки с видео-контентом и возможностью отметить их как просмотренные
    - Карточки с тестами и возможностью начать их прохождение
    - Плейсхолдер для будущих артефактов
    - Блок для завершения уровня с проверкой выполнения всех критериев
  - Интегрированы хуки из проекта:
    - `useLevel` - для получения данных о конкретном уровне
    - `useProgress` - для получения прогресса пользователя
    - `useNextLevel` - для определения следующего уровня
    - `useCompleteLevel` - для функционала завершения уровня
    - `useMarkVideoWatched` и `useMarkTestCompleted` - для маркировки видео и тестов
  - Добавлена обработка состояний:
    - Состояния загрузки с использованием skeleton-компонентов
    - Обработка ошибок с использованием toast-уведомлений
    - Различные состояния для просмотренных/непросмотренных видео
    - Различные состояния для пройденных/непройденных тестов
  - Реализован функционал завершения уровня:
    - Проверка выполнения всех критериев с использованием `canCompleteLevelCheck`
    - Кнопка завершения уровня с состоянием загрузки
    - Перенаправление на карту уровней после успешного завершения
  - Добавлены интерактивные элементы и улучшения UX:
    - Анимации переходов при загрузке и взаимодействии
    - Визуальная индикация статуса элементов (просмотрено, пройдено)
    - Адаптивный дизайн для всех размеров устройств
    - Информативные описания и подсказки
  Страница детального просмотра уровня полностью функциональна и предоставляет пользователю удобный и интуитивно понятный интерфейс для работы с учебными материалами уровня.

- **01.04.2025:** Выполнена задача 5.11 - Реализация отображения контента уровня. Реализована следующая функциональность:
  - Созданы компоненты для отображения контента уровня:
    - `src/components/features/Level/VideoSection.tsx` - компонент для отображения видео
    - `src/components/features/Level/TestSection.tsx` - компонент для отображения тестов
    - `src/components/features/Level/ArtifactSection.tsx` - компонент для отображения артефактов
    - `src/components/features/Level/index.ts` - для экспорта компонентов
  - Реализована функциональность в компонентах:
    - VideoSection: отображение списка видео с возможностью отметки просмотра
    - TestSection: отображение тестов с возможностью отметки прохождения
    - ArtifactSection: отображение артефактов с возможностью скачивания
  - Обновлен файл страницы уровня `src/app/(routes)/level/[levelId]/page.tsx`:
    - Интегрированы новые компоненты для отображения контента
    - Добавлена обработка хука `useMarkArtifactDownloaded`
    - Улучшен UI блока завершения уровня
  - Добавлена обработка различных состояний:
    - Просмотренные/непросмотренные видео
    - Пройденные/непройденные тесты
    - Скачанные/нескачанные артефакты
    - Состояния загрузки для всех действий
  
  Разделение функциональности на компоненты улучшило поддерживаемость кода и обеспечило более чистую архитектуру. Компоненты корректно интегрированы с хуками для обновления прогресса пользователя.

## Следующие Шаги
1. ✅ Выполнить задачу 1.1: Инициализация проекта Next.js
2. ✅ Выполнить задачу 1.2: Установка основных зависимостей
3. ✅ Выполнить задачу 1.3: Настройка shadcn/ui
4. ✅ Выполнить задачу 1.4: Настройка проекта Firebase в консоли
5. ✅ Выполнить задачу 1.5: Создание и настройка файла `.env.local`
6. ✅ Выполнить задачу 1.6: Добавление `.env.local` в `.gitignore`
7. ✅ Выполнить задачу 1.7: Реализация файлов конфигурации Firebase
8. ✅ Выполнить задачу 1.8: Настройка базовых правил безопасности Firestore и Storage
9. ✅ Выполнить задачу 1.9: Создание базовой структуры директорий проекта
10. ✅ Выполнить задачу 1.10: Настройка файла `src/app/providers.tsx`
11. ✅ Выполнить задачу 1.11: Интеграция `Providers` в корневой `src/app/layout.tsx`
12. ✅ Выполнить задачу 2.1: Создание `AuthContext` и `AuthProvider`
13. ✅ Выполнить задачу 2.2: Реализация слушателя `onAuthStateChanged` в `AuthProvider`
14. ✅ Выполнить задачу 2.3: Реализация функций `login`, `register`, `logout`, `resetPassword` в `AuthProvider`
15. ✅ Выполнить задачу 2.4: Интеграция `AuthProvider` в `src/app/providers.tsx`
16. ✅ Выполнить задачу 2.5: Создание хука `useAuth` (`src/hooks/useAuth.ts`)
17. ✅ Выполнить задачу 2.6: Создание макета для страниц аутентификации (`src/app/(auth)/layout.tsx`)
18. ✅ Выполнить задачу 2.7: Создание страниц Login, Register, Reset Password
19. ✅ Выполнить задачу 2.8: Реализация компонентов форм (`LoginForm`, `RegisterForm`)
20. ✅ Выполнить задачу 2.9: Реализация логики защиты роутов
21. ✅ Выполнить задачу 2.10: Реализация редиректов для аутентифицированных/неаутентифицированных пользователей
22. ✅ Выполнить задачу 2.11: Настройка создания записи пользователя в Firestore при регистрации
23. ✅ Выполнить задачу 3.1: Создание компонента `MainLayout`
24. ✅ Выполнить задачу 3.2: Создание компонентов `Sidebar`, `Header`, `UserNav`
25. ✅ Выполнить задачу 3.3: Интеграция `MainLayout` в `src/app/(routes)/layout.tsx`
26. ✅ Выполнить задачу 3.4: Реализация навигации в `Sidebar`
27. ✅ Выполнить задачу 3.5: Настройка редиректа с `/` на `/map` в `src/app/page.tsx`
28. ✅ Выполнить задачу 4.1: Создание `settings-service.ts` для чтения/записи настроек пользователя
29. ✅ Выполнить задачу 4.2: Создание хука `useSettings` с `useQuery` и `useMutation`
30. ✅ Выполнить задачу 4.3: Создание страницы `/profile`
31. ✅ Выполнить задачу 4.4: Отображение информации о пользователе на странице профиля
32. ✅ Выполнить задачу 4.5: Создание страницы `/settings`
33. ✅ Выполнить задачу 4.6: Реализация формы для изменения `displayName`, `photoURL` и настроек
34. ✅ Выполнить задачу 4.7: Интеграция хука `useSettings` для загрузки и сохранения настроек
35. ✅ Выполнить задачу 5.1: Определение основных TypeScript типов
36. ✅ Выполнить задачу 5.2: Создание `firestore.ts` с базовыми хелперами Firestore
37. ✅ Выполнить задачу 5.3: Создание `progress-service.ts` с функциями для работы с `userProgress/{userId}`
38. ✅ Выполнить задачу 5.4: Создание `level-service.ts` для получения данных об уровнях
39. ✅ Выполнить задачу 5.5: Создание хука `useProgress` для работы с прогрессом пользователя
40. ✅ Выполнить задачу 5.6: Создание хуков для работы с уровнями (`useLevels`, `useLevel`, `useLevelsWithStatus`)
41. ✅ Выполнить задачу 5.7: Создание страницы Карты Уровней (`/map`)
42. ✅ Выполнить задачу 5.8: Реализация компонента `LevelMap` для визуализации карты уровней
43. ✅ Выполнить задачу 5.9: Интеграция `useLevels` и `useProgress` в компонент `LevelMap` для отображения актуальных данных
44. ✅ Выполнить задачу 5.10: Создание страницы Деталей Уровня (`/level/[levelId]`)
45. ✅ Выполнить задачу 5.11: Реализация отображения контента уровня

---

**Примечание:** После выполнения каждой задачи обновляйте этот файл с описанием того, что было сделано, каких проблем удалось избежать или какие проблемы были решены.
