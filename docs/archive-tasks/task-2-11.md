# Задача 2.11: Настройка создания записи пользователя в Firestore

## Описание
Реализовать механизм создания записи пользователя в коллекции `users` Firestore при успешной регистрации, чтобы хранить дополнительные данные пользователя, не хранящиеся в Firebase Auth.

## Ссылки на документацию
docs/bizlevel-project-context.md


## Конкретные шаги для Cursor
1. Создать/обновить файл `src/lib/firebase/firestore.ts` для базовых операций с Firestore
2. Создать функцию `createUserDocument` для создания записи пользователя в Firestore
3. Интегрировать функцию с процессом регистрации пользователя
4. Обновить файл `src/lib/firebase/auth.ts` для вызова функции создания записи после успешной регистрации

## Промт для Cursor
```
Помоги мне реализовать механизм создания записи пользователя в Firestore при регистрации для проекта BizLevel.

Нам нужно выполнить следующие шаги:

1. Создать/обновить файл `src/lib/firebase/firestore.ts`:
   - Импортировать необходимые функции из Firebase Firestore
   - Экспортировать функцию getFirestore() для получения инстанса Firestore
   - Создать базовые утилиты для работы с документами и коллекциями (getDocumentById, saveDocument, updateDocument и т.д.)

2. Создать функцию `createUserDocument(userId, userData)`:
   - Должна принимать userId и базовые данные пользователя (email, displayName, photoURL)
   - Создавать документ в коллекции `users` с ID, равным userId
   - Добавлять дополнительные поля: createdAt (timestamp), settings (начальные настройки пользователя)
   - Возвращать Promise с созданным документом или ошибкой

3. Обновить файл `src/lib/firebase/auth.ts`:
   - Импортировать функцию `createUserDocument` из firestore.ts
   - Обновить функцию `registerWithEmailAndPassword`, чтобы она вызывала `createUserDocument` после успешной регистрации
   - Обрабатывать возможные ошибки при создании документа

4. Обновить `src/context/AuthContext.tsx`:
   - Обновить функцию register, чтобы она правильно обрабатывала создание документа пользователя
   - Убедиться, что все ошибки корректно обрабатываются и отображаются пользователю

Пожалуйста, реализуй эти файлы и функции для обеспечения создания записи пользователя в Firestore при регистрации.

После выполнения задачи обнови status.md, указав, что задача 2.11 выполнена.
```

## Ожидаемый результат
- Созданный/обновленный файл `src/lib/firebase/firestore.ts` с базовыми операциями Firestore
- Реализованная функция `createUserDocument` для создания записи пользователя
- Обновленный файл `src/lib/firebase/auth.ts` с интеграцией функции создания записи
- Обновленный файл `src/context/AuthContext.tsx` с обработкой создания записи пользователя
- Обновленный файл status.md с отметкой о выполнении задачи 2.11

## Связь с другими задачами
- Эта задача следует за задачей 2.10: Реализация редиректов для аутентифицированных/неаутентифицированных пользователей
- После выполнения этой задачи завершается Этап 2 и можно перейти к Этапу 3: Базовый Макет и Навигация, начиная с задачи 3.1: Создание компонента `MainLayout`

## Обновление progress-tracking
После выполнения задачи обновите файл development-plan.md, заменив `[ ]` на `[x]` для этой задачи:
```
* [x] **task-2.11-setup-firestore-user-creation.md**: Настройка создания записи пользователя в Firestore (`users/{userId}`) при регистрации
```
