# Задача 9.7: Реализация CRUD-операций для пользователей

## Описание
Реализовать полную функциональность CRUD-операций (Create, Read, Update, Delete) для управления пользователями в админ-панели, включая создание новых пользователей, редактирование профилей и удаление учетных записей.

## Конкретные шаги для Cursor
1. Расширить сервисный слой для полной поддержки CRUD-операций с пользователями
2. Обновить хуки для управления пользователями
3. Создать формы для создания и редактирования пользователей
4. Интегрировать операции с Firebase Auth и Firestore

## Промт для Cursor
```
Помоги мне реализовать полную функциональность CRUD-операций для управления пользователями в админ-панели проекта BizLevel.

Нам нужно расширить существующую страницу управления пользователями, добавив возможность создания новых пользователей, редактирования профилей и удаления учетных записей, с интеграцией как с Firebase Auth, так и с Firestore. Для этого выполним следующие шаги:

1. Расширь файл `src/lib/services/admin-service.ts`:
   - Добавь или обнови функции для полной поддержки CRUD-операций с пользователями:
     - `createUser(email: string, password: string, userData: Omit<User, 'id' | 'email' | 'createdAt'>): Promise<string>` - создание нового пользователя (в Firebase Auth и Firestore)
     - `updateUserProfile(userId: string, userData: Partial<User>): Promise<void>` - обновление профиля пользователя
     - `resetUserPassword(email: string): Promise<void>` - сброс пароля пользователя
     - `disableUser(userId: string): Promise<void>` - блокировка пользователя (без удаления)
     - `enableUser(userId: string): Promise<void>` - разблокировка пользователя
     - `deleteUser(userId: string): Promise<void>` - удаление пользователя (из Firebase Auth и Firestore)
     - `getUsersWithProgress(): Promise<Array<User & {progress?: UserProgress}>>` - получение списка пользователей с их прогрессом

2. Обнови файл `src/hooks/useUsers.ts`:
   - Добавь или обнови хуки для использования расширенных функций:
     - `useCreateUser()` - хук для создания нового пользователя
     - `useUpdateUserProfile()` - хук для обновления профиля пользователя
     - `useResetUserPassword()` - хук для сброса пароля пользователя
     - `useDisableUser()` - хук для блокировки пользователя
     - `useEnableUser()` - хук для разблокировки пользователя
     - `useUsersWithProgress()` - хук для получения пользователей с их прогрессом

3. Создай файл `src/components/admin/users/UserFormDialog.tsx`:
   - Модальное окно с формой для создания/редактирования пользователя
   - Должно включать поля:
     - email - email пользователя (только для создания)
     - password - пароль (только для создания)
     - displayName - имя пользователя
     - role - роль пользователя (user/admin)
     - settings - настройки пользователя (theme, notificationsEnabled)
   - Должно валидировать данные с помощью Zod
   - Должно обрабатывать состояния загрузки и ошибок
   - Должно использовать компоненты из shadcn/ui (Dialog, Form)

4. Создай файл `src/components/admin/users/UserDetailDialog.tsx`:
   - Модальное окно для просмотра детальной информации о пользователе
   - Должно отображать:
     - Основную информацию (email, имя, дата регистрации)
     - Прогресс по уровням (если есть)
     - Скачанные артефакты (если есть)
     - Статистику по навыкам (если есть)
   - Должно иметь кнопки для редактирования, сброса пароля, блокировки/разблокировки и удаления
   - Должно использовать компоненты из shadcn/ui (Dialog, Tabs)

5. Обнови файл `src/components/admin/users/DeleteUserDialog.tsx`:
   - Добавь опцию выбора между полным удалением и блокировкой

6. Создай файл `src/components/admin/users/ResetPasswordDialog.tsx`:
   - Модальное окно для сброса пароля пользователя
   - Должно отправлять email для сброса пароля
   - Должно обрабатывать состояния загрузки и ошибок
   - Должно использовать компоненты из shadcn/ui (Dialog)

7. Обнови файл `src/components/admin/users/UsersList.tsx`:
   - Добавь индикаторы состояния пользователя (активен/заблокирован)
   - Добавь кнопку для просмотра детальной информации о пользователе
   - Добавь кнопки для быстрых действий (блокировка/разблокировка, сброс пароля)

8. Обнови страницу `src/app/(admin)/users/page.tsx`:
   - Добавь кнопку "Создать пользователя"
   - Интегрируй новые компоненты и функциональность
   - Улучши UX и обработку ошибок

Все компоненты должны:
- Использовать компоненты из shadcn/ui для стилизации
- Быть типизированы с использованием TypeScript
- Иметь адаптивный дизайн для разных размеров экрана
- Обрабатывать состояния загрузки и ошибок
- Использовать toast-уведомления для обратной связи

Пожалуйста, создай и обнови указанные файлы для реализации полной функциональности CRUD-операций с пользователями.

После выполнения задачи обнови status.md, указав, что задача 9.7 выполнена.
```

## Ожидаемый результат
- Обновленный файл `src/lib/services/admin-service.ts` с функциями для полной поддержки CRUD-операций с пользователями
- Обновленный файл `src/hooks/useUsers.ts` с дополнительными хуками
- Созданные файлы:
  - `src/components/admin/users/UserFormDialog.tsx`
  - `src/components/admin/users/UserDetailDialog.tsx`
  - `src/components/admin/users/ResetPasswordDialog.tsx`
- Обновленные файлы:
  - `src/components/admin/users/DeleteUserDialog.tsx`
  - `src/components/admin/users/UsersList.tsx`
  - `src/app/(admin)/users/page.tsx`
- Полная функциональность CRUD-операций с пользователями
- Интеграция с Firebase Auth и Firestore
- Улучшенный UX и обработка ошибок
- Обновленный файл status.md с отметкой о выполнении задачи 9.7

## Связь с другими задачами
- Эта задача следует за задачей 9.6: Создание страницы управления артефактами
- После выполнения этой задачи следует перейти к задаче 9.8: Реализация CRUD-операций для уровней

## Обновление progress-tracking
После выполнения задачи обновите файл development-plan.md, заменив `[ ]` на `[x]` для этой задачи:
```
* [x] **task-9.7-implement-user-crud.md**: Реализация CRUD-операций для пользователей
```
