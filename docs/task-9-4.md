# Задача 9.4: Создание страницы управления пользователями

## Описание
Разработать страницу управления пользователями в админ-панели, которая позволит просматривать, искать, фильтровать и редактировать информацию о пользователях.

## Ссылки на документацию
- [Требование дополнительной админ-панели](../paste.txt): Упоминание необходимости создания админ-панели для управления пользователями

## Конкретные шаги для Cursor
1. Создать сервисный слой для работы с пользователями в админ-панели
2. Создать хук для получения и управления данными пользователей
3. Разработать компоненты для отображения списка пользователей
4. Реализовать функциональность поиска и фильтрации

## Промт для Cursor
```
Помоги мне создать страницу управления пользователями для админ-панели в проекте BizLevel.

Нам нужно создать функциональную страницу управления пользователями, которая позволит администраторам просматривать, искать, фильтровать и редактировать информацию о пользователях. Для этого выполним следующие шаги:

1. Создай файл `src/lib/services/admin-service.ts`:
   - Сервисный слой для админ-функциональности
   - Реализуй функции:
     - `getUsers(filters?: {search?: string, role?: string}): Promise<User[]>` - получение списка пользователей с фильтрацией
     - `getUserById(userId: string): Promise<User | null>` - получение информации о конкретном пользователе
     - `updateUserRole(userId: string, role: 'user' | 'admin'): Promise<void>` - обновление роли пользователя
     - `deleteUser(userId: string): Promise<void>` - удаление пользователя (только из Firestore, не из Firebase Auth)
     - `getUserStats(): Promise<{totalUsers: number, activeUsers: number, admins: number}>` - получение статистики по пользователям

2. Создай файл `src/hooks/useUsers.ts`:
   - Хук для работы с пользователями в админ-панели
   - Используй React Query для получения и кэширования данных
   - Реализуй:
     - `useUsers(filters?: {search?: string, role?: string})` - хук для получения списка пользователей
     - `useUser(userId: string)` - хук для получения информации о конкретном пользователе
     - `useUpdateUserRole()` - хук для обновления роли пользователя
     - `useDeleteUser()` - хук для удаления пользователя
     - `useUserStats()` - хук для получения статистики

3. Создай файл `src/components/admin/users/UsersList.tsx`:
   - Компонент для отображения списка пользователей
   - Должен использовать таблицу или карточки для отображения пользователей
   - Должен отображать ключевую информацию: имя, email, роль, дата регистрации
   - Должен иметь кнопки для редактирования и удаления
   - Должен обрабатывать состояния загрузки и ошибок
   - Должен использовать компоненты из shadcn/ui (Table или Card)

4. Создай файл `src/components/admin/users/UserFilters.tsx`:
   - Компонент с фильтрами для списка пользователей
   - Должен включать поиск по имени или email
   - Должен включать фильтр по роли (все, пользователи, администраторы)
   - Должен использовать компоненты из shadcn/ui (Input, Select)

5. Создай файл `src/components/admin/users/UserRoleDialog.tsx`:
   - Модальное окно для изменения роли пользователя
   - Должно отображать текущую роль и позволять выбрать новую
   - Должно обрабатывать состояния загрузки и ошибок
   - Должно использовать компоненты из shadcn/ui (Dialog, RadioGroup)

6. Создай файл `src/components/admin/users/DeleteUserDialog.tsx`:
   - Модальное окно для подтверждения удаления пользователя
   - Должно предупреждать о необратимости действия
   - Должно обрабатывать состояния загрузки и ошибок
   - Должно использовать компоненты из shadcn/ui (AlertDialog)

7. Обнови страницу `src/app/(admin)/users/page.tsx`:
   - Используй созданные компоненты для построения функциональной страницы
   - Реализуй состояние фильтров и поиска
   - Интегрируй хуки для получения и управления данными
   - Добавь обработку ошибок и состояний загрузки

8. Создай файл `src/components/admin/users/index.ts` для экспорта компонентов

Все компоненты должны:
- Использовать компоненты из shadcn/ui для стилизации
- Быть типизированы с использованием TypeScript
- Иметь адаптивный дизайн для разных размеров экрана
- Обрабатывать состояния загрузки и ошибок

Пожалуйста, создай указанные файлы и обнови страницу управления пользователями.

После выполнения задачи обнови status.md, указав, что задача 9.4 выполнена.
```

## Ожидаемый результат
- Созданные файлы:
  - `src/lib/services/admin-service.ts`
  - `src/hooks/useUsers.ts`
  - `src/components/admin/users/UsersList.tsx`
  - `src/components/admin/users/UserFilters.tsx`
  - `src/components/admin/users/UserRoleDialog.tsx`
  - `src/components/admin/users/DeleteUserDialog.tsx`
  - `src/components/admin/users/index.ts`
- Обновленная страница `src/app/(admin)/users/page.tsx`
- Работающая функциональность просмотра, поиска и фильтрации пользователей
- Возможность изменения роли пользователя и удаления пользователя
- Обработка состояний загрузки и ошибок
- Обновленный файл status.md с отметкой о выполнении задачи 9.4

## Связь с другими задачами
- Эта задача следует за задачей 9.3: Реализация навигации в админ-панели
- После выполнения этой задачи следует перейти к задаче 9.5: Создание страницы управления уровнями

## Обновление progress-tracking
После выполнения задачи обновите файл development-plan.md, заменив `[ ]` на `[x]` для этой задачи:
```
* [x] **task-9.4-create-user-management.md**: Создание страницы управления пользователями
```
