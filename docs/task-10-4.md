# Задача 10.4: Оптимизация производительности

## Описание
Повысить производительность приложения BizLevel за счет оптимизации кода, улучшения кеширования данных, внедрения code splitting и устранения узких мест в работе приложения.

## Ссылки на документацию
- [Этап 10, Шаг 4](../development-plan.md): Оптимизация производительности (React Query caching, code splitting)
- [Раздел 2: Технологический Стек](../bizlevel-project-context.md): Технологии для оптимизации производительности

## Конкретные шаги для Cursor
1. Оптимизация стратегии кеширования React Query
2. Внедрение code splitting с использованием dynamic imports
3. Оптимизация загрузки изображений и медиа-контента
4. Мемоизация компонентов и хуков
5. Анализ и устранение узких мест производительности

## Промт для Cursor
```
Помоги мне оптимизировать производительность приложения BizLevel, сосредоточившись на следующих направлениях:

1. Оптимизация кеширования с React Query:
   - Проведем аудит всех запросов и мутаций в приложении
   - Настроим оптимальное время staleTime и cacheTime для ключевых запросов:
     - Статичные данные (уровни, FAQ) получат длительный staleTime
     - Динамичные данные (прогресс пользователя) получат короткий staleTime
   - Реализуем предварительную загрузку связанных данных (prefetching)
   - Оптимизируем инвалидацию кеша, используя точные паттерны queryKey

2. Внедрение code splitting:
   - Реализуем динамический импорт для тяжелых компонентов:
     - Страница деталей уровня
     - Админ-панель
     - Чат с AI
   - Используем Next.js dynamic для ленивой загрузки компонентов
   - Создадим компонент LazyLoad для отложенной загрузки контента за пределами видимой области
   - Настроим preloading ключевых компонентов при наведении на ссылки

3. Оптимизация загрузки мультимедиа:
   - Настроим оптимизацию изображений с помощью next/image
   - Реализуем ленивую загрузку для изображений и видео
   - Добавим отложенную загрузку для YouTube видео (youtube-lite)
   - Внедрим прогрессивную загрузку изображений

4. Мемоизация и предотвращение ненужных рендеров:
   - Используем React.memo для компонентов, которые часто ререндерятся
   - Применим useMemo для тяжелых вычислений
   - Используем useCallback для функций, передаваемых в компоненты
   - Проведем аудит использования useEffect и оптимизируем массивы зависимостей

5. Анализ и устранение узких мест:
   - Внедрим измерение производительности с помощью web-vitals
   - Проведем аудит производительности с Lighthouse
   - Настроим мониторинг производительности в реальных условиях
   - Оптимизируем CSS и JS бандлы

6. Оптимизация запросов к Firestore:
   - Проверим индексы для часто выполняемых запросов
   - Оптимизируем запросы с фильтрацией для снижения затрат на чтение
   - Настроим оффлайн-персистентность для повышения отзывчивости
   - Реализуем пагинацию для больших коллекций данных

7. Улучшение параллельности:
   - Используем Promise.all для параллельного выполнения независимых запросов
   - Оптимизируем порядок загрузки критических данных
   - Предпочтем пакетную обработку данных вместо последовательных операций

Важно после каждой оптимизации измерять результат, чтобы убедиться в эффективности изменений.
```

## Ожидаемый результат
- Улучшенная стратегия кеширования с React Query
- Внедренный code splitting для тяжелых страниц и компонентов
- Оптимизированная загрузка изображений и видео
- Мемоизация компонентов с высокой частотой рендеринга
- Оптимизированные запросы к Firestore
- Измеренные и улучшенные метрики производительности (LCP, FID, CLS)
- Документированные оптимизации и их эффект
- Обновленный файл status.md с отметкой о выполнении задачи 10.4

## Связь с другими задачами
- Эта задача следует за задачей 10.3: Реализация обратной связи с пользователем
- После выполнения этой задачи следует перейти к задаче 10.5: Финализация документации

## Обновление progress-tracking
После выполнения задачи обновите файл development-plan.md, заменив `[ ]` на `[x]` для этой задачи:
```
* [x] **task-10.4-optimize-performance.md**: Оптимизация производительности (React Query caching, code splitting)
``` 