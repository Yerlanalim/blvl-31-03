# План исправления ошибок в тестах

## 1. Формы аутентификации

### 1.1. Валидация email
- **Проблема**: Тесты для `LoginForm` и `RegisterForm` ожидают текст ошибки "неверный формат email", но он не отображается
- **Задачи**:
  - Проверить реализацию валидации в формах
  - Убедиться, что сообщения об ошибках корректно отображаются в UI
  - Исправить компоненты форм для отображения ошибок валидации

### 1.2. Состояние загрузки форм
- **Проблема**: Кнопки отправки форм не переходят в состояние disabled при отправке
- **Задачи**:
  - Добавить атрибут disabled для кнопок при isSubmitting=true
  - Убедиться, что текст кнопки меняется на "Вход..." или "Регистрация..." при загрузке

## 2. Тесты Firebase

### 2.1. Проблема с API-ключом
- **Проблема**: Тест `useAuth.test.ts` падает с ошибкой "Firebase: Error (auth/invalid-api-key)"
- **Задачи**:
  - Создать правильный мок для Firebase Auth в тестовом окружении
  - Убедиться, что тесты не обращаются к реальной Firebase

### 2.2. Моки для Firestore
- **Проблема**: Тесты `progress-service.test.ts` не находят моки для методов Firebase
- **Задачи**:
  - Корректно настроить моки для `saveDocument`, `arrayUnionItem` и других методов
  - Обновить файл мока для Firestore, чтобы он экспортировал все необходимые методы

## 3. Сервисы уровней и прогресса

### 3.1. Определение последнего уровня
- **Проблема**: `getNextLevelId` возвращает 'level-3' вместо null для последнего уровня
- **Задачи**:
  - Исправить логику определения последнего уровня в функции `getNextLevelId`
  - Убедиться, что для последнего уровня возвращается null

### 3.2. Локализация сообщений об ошибках
- **Проблема**: Сообщения об ошибках выводятся на английском, а тесты ожидают их на русском
- **Задачи**:
  - Обновить сообщения об ошибках в `level-service.ts` на русский язык
  - Убедиться, что сообщение содержит фразу "не найден" вместо "not found"

### 3.3. Прогресс пользователя
- **Проблема**: Ошибка "Прогресс пользователя user-1 не найден" в тестах `completeLevel`
- **Задачи**:
  - Правильно настроить мок для `getUserProgress` в тестах
  - Убедиться, что мок возвращает данные прогресса для тестового пользователя

## 4. Компоненты для карты уровней

### 4.1. Обработка событий клика
- **Проблема**: Обработчики событий клика не вызываются в `LevelCard` и `LevelMap`
- **Задачи**:
  - Проверить реализацию обработчиков событий
  - Убедиться, что клик по карточке уровня корректно передает levelId

### 4.2. Компонент скелетона
- **Проблема**: Не найдены элементы с тестовым идентификатором 'skeleton'
- **Задачи**:
  - Добавить атрибут data-testid к компонентам скелетона в LevelMap
  - Проверить компонент `LevelCardSkeleton`

## 5. Синтаксические ошибки

### 5.1. Ошибка синтаксиса в `useProgress.test.ts`
- **Проблема**: Ошибка синтаксиса "Expected > but found client"
- **Задачи**:
  - Исправить синтаксическую ошибку на строке 39
  - Проверить правильность JSX-синтаксиса в тесте

## Приоритеты исправления:

1. Синтаксические ошибки - блокируют выполнение тестов
2. Моки Firebase - критичны для большинства тестов
3. Валидация форм и состояние загрузки
4. Логика сервисов
5. Компоненты карты уровней
